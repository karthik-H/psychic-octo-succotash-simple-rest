{
  "add_new_user": {
    "implementation": [
      {
        "function_name": "create_user",
        "file_path": "app/routers/users.py",
        "How_is_it_connected_to_implementation": "API endpoint for adding a new user. Receives user data, checks for duplicate email, and calls the service layer to create the user.",
        "pseudo_code": "If a user with the given email exists, raise HTTP 400. Otherwise, call the service to create the user and return the result."
      },
      {
        "function_name": "get_user_by_email",
        "file_path": "app/services.py",
        "How_is_it_connected_to_implementation": "Checks if a user with the given email already exists in the database. Used to enforce the unique email constraint before creating a new user.",
        "pseudo_code": "Query the database for a user with the given email. Return the user if found, else return None."
      },
      {
        "function_name": "create_user",
        "file_path": "app/services.py",
        "How_is_it_connected_to_implementation": "Handles the actual creation of the user in the database. Adds the user and commits the transaction.",
        "pseudo_code": "Create a new User model instance with the provided email and name. Add to the database session, commit, refresh, and return the user."
      }
    ],
    "missing_implementations": [
      "Username must not be duplicate",
      "Age must be in the range 0-150",
      "If work_role is not provided, default to developer"
    ]
  },
  "update_email_address": {
    "implementation": [
      {
        "function_name": "update_user",
        "file_path": "app/routers/users.py",
        "How_is_it_connected_to_implementation": "This is the FastAPI route handler for updating a user's information, including their email address. It receives the HTTP PUT request, calls the service layer to perform the update, and returns the updated user or an error if not found.",
        "pseudo_code": "On PUT /users/{user_id}, call services.user_service.update_user(db, user_id, user). If the user is not found, raise a 404 error. Otherwise, return the updated user."
      },
      {
        "function_name": "update_user",
        "file_path": "app/services.py",
        "How_is_it_connected_to_implementation": "This service function performs the actual update of the user's email address in the database. It is called by the API router and handles fetching the user, updating the email and name, committing the transaction, and returning the updated user.",
        "pseudo_code": "Fetch user by user_id. If user exists, set db_user.email = user.email and db_user.name = user.name, commit, refresh, and return db_user. If user does not exist, return None."
      }
    ],
    "missing_implementations": [
      "Do not update if the previous email is the same as the updated one"
    ]
  },
  "deactivate_user_account": {
    "implementation": [
      {
        "function_name": "delete_user",
        "file_path": "app/routers/users.py",
        "How_is_it_connected_to_implementation": "This is the API endpoint for deleting a user account. It is the only endpoint that could be interpreted as 'deactivating' a user account, but it actually deletes the user from the database.",
        "pseudo_code": "When a DELETE request is made to /users/{user_id}, call services.user_service.delete_user(db, user_id). If the user does not exist, return 404. Otherwise, return the deleted user."
      },
      {
        "function_name": "UserService.delete_user",
        "file_path": "app/services.py",
        "How_is_it_connected_to_implementation": "This service function is called by the API endpoint to perform the actual deletion of the user from the database.",
        "pseudo_code": "Fetch the user by user_id. If the user exists, delete the user from the database and commit the transaction. Return the deleted user object."
      }
    ],
    "missing_implementations": [
      "No function implements a true 'deactivate' (soft delete or status change) for user accounts. The current implementation deletes the user entirely from the database instead of deactivating the account."
    ]
  },
  "calculate_average_age": {
    "implementation": [],
    "missing_implementations": [
      "Calculate average age of active users.",
      "Only active users are considered"
    ]
  },
  "categorize_user_into_age": {
    "implementation": [],
    "missing_implementations": [
      "Youth: 0-17",
      "Adult: 18-64",
      "Senior: 65+"
    ]
  }
}